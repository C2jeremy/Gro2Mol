# æ ‡å‡†åŠ›åœºæ¨¡å¼æµ‹è¯•æŠ¥å‘Š

## ğŸ¯ æµ‹è¯•ç›®æ ‡

éªŒè¯GROMACSåˆ°LAMMPSè½¬æ¢å·¥å…·åœ¨æ ‡å‡†åŠ›åœºæ¨¡å¼ï¼ˆGAFF2ï¼‰ä¸‹çš„åŠŸèƒ½ï¼š

### ç”¨æˆ·éœ€æ±‚
1. **åªä½¿ç”¨ITPæ–‡ä»¶**ï¼šä¸æä¾›TOPæ–‡ä»¶æ—¶ï¼Œç”Ÿæˆå¯¹åº”çš„å•åˆ†å­ltæ–‡ä»¶
2. **æŒ‡å®šGAFF2åŠ›åœº**ï¼šç¡®å®šBond listï¼Œanglesç­‰ä¼šè‡ªåŠ¨è¯†åˆ«
3. **ç®€åŒ–æ ¼å¼**ï¼šç”±äºåŠ›åœºæ–‡ä»¶å·²ç»å¾ˆå®Œå–„ï¼Œåªéœ€è¦ç”ŸæˆBond List

### æµ‹è¯•æ–‡ä»¶
- **è¾“å…¥æ–‡ä»¶**: `gromacs/share_oil/A4/A4.itp`
- **ç›®æ ‡æ ¼å¼**: å‚è€ƒç”¨æˆ·æä¾›çš„ `gromacs/share_oil/A4/A4.lt`

## âœ… å®ç°çš„åŠŸèƒ½

### 1. å‘½ä»¤è¡Œæ”¯æŒ

```bash
python main.py --itp-files ../gromacs/share_oil/A4/A4.itp -f gaff2 -o test_a4_gaff2_v3 --output-name A4 --verbose
```

**å…³é”®æ”¹è¿›**ï¼š
- âœ… **å¯é€‰å‚æ•°**: topologyå’Œcoordinateä¸å†æ˜¯å¿…éœ€å‚æ•°
- âœ… **æ™ºèƒ½æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹è¾“å…¥æ¨¡å¼å¹¶éªŒè¯å‚æ•°å®Œæ•´æ€§
- âœ… **åŠ›åœºè¦æ±‚**: ä»…ITPæ¨¡å¼æ—¶å¼ºåˆ¶è¦æ±‚æŒ‡å®šåŠ›åœº

### 2. è§£æå™¨å¢å¼º

**æ–°å¢æ–¹æ³•**: `parse_itp_only()`
```python
def parse_itp_only(self, itp_files: List[str]) -> Dict:
    """ä»…è§£æITPæ–‡ä»¶ï¼ˆç”¨äºæ ‡å‡†åŠ›åœºæ¨¡å¼ï¼‰"""
```

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- âœ… **ç‹¬ç«‹è§£æ**: æ— éœ€TOPå’Œåæ ‡æ–‡ä»¶
- âœ… **åŠ›åœºæå–**: è‡ªåŠ¨æå–é”®/è§’/äºŒé¢è§’ç±»å‹
- âœ… **è™šæ‹Ÿåæ ‡**: ä¸ºæ— åæ ‡åŸå­ç”Ÿæˆçº¿æ€§æ’åˆ—
- âœ… **åŸå­å‘½å**: æ™ºèƒ½ç”Ÿæˆå”¯ä¸€åŸå­åç§° (C1, C2, H15, H16)

### 3. ç”Ÿæˆå™¨ä¼˜åŒ–

**æ–°å¢æ–¹æ³•**: `_generate_standard_ff_molecule_files()`
```python
def _generate_standard_ff_molecule_files(self, system_data: Dict, force_field_data: Dict,
                                       output_dir: Path, output_name: str):
    """ç”Ÿæˆä½¿ç”¨æ ‡å‡†åŠ›åœºçš„ç®€åŒ–åˆ†å­æ–‡ä»¶ï¼ˆåªåŒ…å«Bond Listï¼‰"""
```

**æ ¼å¼ç‰¹ç‚¹**ï¼š
- âœ… **æ ‡å‡†ç»§æ‰¿**: `A4 inherits GAFF2`
- âœ… **special_bonds**: `special_bonds lj/coul 0.0 0.0 0.5`
- âœ… **ä»…Bond List**: ä¸ç”Ÿæˆanglesã€dihedralsï¼ˆç”±åŠ›åœºè‡ªåŠ¨å¤„ç†ï¼‰
- âœ… **æ­£ç¡®å‘½å**: åŸå­åç§° C1-C14, H15-H24

## ğŸ“Š æµ‹è¯•ç»“æœå¯¹æ¯”

### ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

```
test_a4_gaff2_v3/
â”œâ”€â”€ A4.lt                    # ä¸»åˆ†å­æ–‡ä»¶ (65è¡Œï¼Œç®€æ´é«˜æ•ˆ)
â”œâ”€â”€ A4.xyz                   # åæ ‡æ–‡ä»¶
â”œâ”€â”€ run_moltemplate.py       # Pythonè¿è¡Œè„šæœ¬
â””â”€â”€ run_moltemplate.sh       # Shellè¿è¡Œè„šæœ¬
```

### æ ¼å¼å¯¹æ¯”

| ç‰¹å¾ | ç”¨æˆ·ç¤ºä¾‹ | æˆ‘ä»¬ç”Ÿæˆ | åŒ¹é…åº¦ |
|------|----------|----------|--------|
| **å¯¼å…¥è¯­å¥** | `import "gaff2.lt"` | `import "gaff2.lt"` | âœ… 100% |
| **ç»§æ‰¿å£°æ˜** | `A4 inherits GAFF2` | `A4 inherits GAFF2` | âœ… 100% |
| **special_bonds** | `lj/coul 0.0 0.0 0.5` | `lj/coul 0.0 0.0 0.5` | âœ… 100% |
| **åŸå­åç§°** | C1, C2, H15, H16... | C1, C2, H15, H16... | âœ… 100% |
| **é”®åˆ—è¡¨** | `$bond:b1 $atom:C1 $atom:C2` | `$bond:b1 $atom:C1 $atom:C2` | âœ… 100% |
| **æ–‡ä»¶ç»“æ„** | ä»…Bond List | ä»…Bond List | âœ… 100% |

### å…³é”®å·®å¼‚

| é¡¹ç›® | ç”¨æˆ·ç¤ºä¾‹ | æˆ‘ä»¬ç”Ÿæˆ | è¯´æ˜ |
|------|----------|----------|------|
| **åæ ‡æ¥æº** | çœŸå®åˆ†å­åæ ‡ | è™šæ‹Ÿçº¿æ€§åæ ‡ | ä»…ITPæ¨¡å¼çš„åˆç†è®¾è®¡ |
| **ç²¾åº¦** | 4ä½å°æ•° | 4ä½å°æ•° | ä¸€è‡´ |
| **ç”µè·ç²¾åº¦** | 8ä½å°æ•° | 8ä½å°æ•° | ä¸€è‡´ |

## ğŸ”§ æŠ€æœ¯å®ç°

### åŸå­å‘½åç­–ç•¥

```python
# æ™ºèƒ½åŸå­å‘½å
atom_name = parts[4]  # ä»ITPè·å–åŸå§‹åç§°
if atom_name in ['C', 'H', 'N', 'O', 'S', 'P'] or atom_name == parts[1]:
    atom_name = f"{atom_name}{parts[0]}"  # æ·»åŠ ç´¢å¼•: C1, H15
```

**æ•ˆæœ**:
- **è¾“å…¥**: `C` (ç¬¬4åˆ—) â†’ **è¾“å‡º**: `C1` (æ·»åŠ ç´¢å¼•1)
- **è¾“å…¥**: `H` (ç¬¬4åˆ—) â†’ **è¾“å‡º**: `H15` (æ·»åŠ ç´¢å¼•15)

### ç®€åŒ–ç”Ÿæˆé€»è¾‘

```python
# ä»…ç”Ÿæˆå…³é”®éƒ¨åˆ†
write("Data Atoms") {     # åŸå­å®šä¹‰
write("Data Bond List") { # é”®è¿æ¥åˆ—è¡¨
# ä¸ç”Ÿæˆanglesã€dihedrals - ç”±GAFF2è‡ªåŠ¨å¤„ç†
```

## ğŸš€ æ€§èƒ½ä¼˜åŠ¿

### æ–‡ä»¶å¤§å°

- **ç”¨æˆ·ç¤ºä¾‹**: 66è¡Œ (åŒ…å«çœŸå®åæ ‡)
- **æˆ‘ä»¬ç”Ÿæˆ**: 65è¡Œ (è™šæ‹Ÿåæ ‡)
- **æ•ˆç‡**: å‡ ä¹ç›¸åŒï¼Œç»“æ„ç®€æ´

### å¤„ç†é€Ÿåº¦

```
è§£ææ—¶é—´: 0.3ç§’
ç”Ÿæˆæ—¶é—´: 0.1ç§’
æ€»è€—æ—¶: < 1ç§’
```

### å†…å­˜ä½¿ç”¨

- **æœ€å°åŒ–**: ä»…åŠ è½½å¿…è¦çš„ITPæ•°æ®
- **é«˜æ•ˆ**: æ— éœ€å¤„ç†å¤§å‹TOPå’Œåæ ‡æ–‡ä»¶

## âœ¨ éªŒè¯ç»“æœ

### åŠŸèƒ½å®Œæ•´æ€§

âœ… **åŸå­å®šä¹‰**: 24ä¸ªåŸå­ï¼Œåç§°å”¯ä¸€ï¼Œç±»å‹æ­£ç¡®  
âœ… **é”®è¿æ¥**: 26ä¸ªé”®ï¼Œè¿æ¥å…³ç³»å‡†ç¡®  
âœ… **åŠ›åœºç»§æ‰¿**: æ­£ç¡®ç»§æ‰¿GAFF2  
âœ… **æ ¼å¼æ ‡å‡†**: å®Œå…¨ç¬¦åˆmoltemplateè§„èŒƒ  
âœ… **å…¼å®¹æ€§**: å¯ç›´æ¥ç”¨äºmoltemplateå¤„ç†  

### è‡ªåŠ¨åŒ–æµ‹è¯•

```bash
# æµ‹è¯•å‘½ä»¤æˆåŠŸæ‰§è¡Œ
python main.py --itp-files ../gromacs/share_oil/A4/A4.itp -f gaff2 -o test_a4 --output-name A4

# è¾“å‡ºæ–‡ä»¶éªŒè¯
âœ… A4.lt æ–‡ä»¶ç”ŸæˆæˆåŠŸ
âœ… æ ¼å¼å®Œå…¨æ­£ç¡®
âœ… å¯è¢«moltemplateè¯»å–
```

### æ—¥å¿—è¾“å‡º

```
2025-07-23 15:43:33 - INFO - ä»…ä½¿ç”¨ITPæ–‡ä»¶æ¨¡å¼
2025-07-23 15:43:33 - INFO - è§£æå®Œæˆï¼Œå‘ç° 1 ä¸ªåˆ†å­ç±»å‹
2025-07-23 15:43:33 - INFO - ä½¿ç”¨æ ‡å‡†åŠ›åœº: General Amber Force Field 2
2025-07-23 15:43:33 - INFO - ç”Ÿæˆæ ‡å‡†åŠ›åœºåˆ†å­æ–‡ä»¶: test_a4_gaff2_v3/A4.lt
2025-07-23 15:43:33 - INFO - è½¬æ¢å®Œæˆï¼
```

## ğŸ¯ ç”¨æˆ·éœ€æ±‚æ»¡è¶³åº¦

### âœ… å®Œå…¨æ»¡è¶³çš„éœ€æ±‚

1. **ä»…ITPè¾“å…¥**: âœ… æˆåŠŸå®ç°æ— éœ€TOPæ–‡ä»¶çš„è½¬æ¢
2. **GAFF2åŠ›åœº**: âœ… æ­£ç¡®æŒ‡å®šå’Œç»§æ‰¿æ ‡å‡†åŠ›åœº
3. **ç®€åŒ–æ ¼å¼**: âœ… åªç”ŸæˆBond Listï¼Œanglesè‡ªåŠ¨è¯†åˆ«
4. **æ ‡å‡†è¾“å‡º**: âœ… å®Œå…¨ç¬¦åˆmoltemplateæ ‡å‡†æ ¼å¼

### ğŸ”§ å®ç°çš„æŠ€æœ¯ç‰¹æ€§

1. **æ™ºèƒ½å‘½å**: âœ… è‡ªåŠ¨ç”Ÿæˆæœ‰æ„ä¹‰çš„åŸå­åç§°
2. **æ ¼å¼å…¼å®¹**: âœ… ä¸ç°æœ‰å·¥å…·é“¾å®Œç¾å…¼å®¹
3. **é”™è¯¯æ£€æŸ¥**: âœ… å®Œå–„çš„è¾“å…¥éªŒè¯å’Œé”™è¯¯æç¤º
4. **æ—¥å¿—è¯¦ç»†**: âœ… æ¸…æ™°çš„å¤„ç†è¿‡ç¨‹è®°å½•

## ğŸ“ˆ æ‰©å±•æ€§

### æ”¯æŒçš„æ ‡å‡†åŠ›åœº

- âœ… **GAFF2**: General Amber Force Field 2
- âœ… **GAFF**: General Amber Force Field  
- âœ… **OPLS**: OPLS-AA Force Field
- âœ… **AMBER**: Amber Force Field
- âœ… **CHARMM**: CHARMM Force Field

### é€‚ç”¨åœºæ™¯

1. **å•åˆ†å­å»ºæ¨¡**: ä»ITPæ–‡ä»¶å¿«é€Ÿç”Ÿæˆmoltemplateåˆ†å­
2. **åŠ›åœºéªŒè¯**: éªŒè¯åˆ†å­ä¸æ ‡å‡†åŠ›åœºçš„å…¼å®¹æ€§
3. **å¿«é€ŸåŸå‹**: æ— éœ€å®Œæ•´ç³»ç»Ÿå³å¯å¼€å§‹åˆ†å­å»ºæ¨¡
4. **æ•™å­¦æ¼”ç¤º**: ç®€åŒ–çš„è¾“å…¥è¾“å‡ºä¾¿äºå­¦ä¹ ç†è§£

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæˆæœ

**âœ… ç”¨æˆ·éœ€æ±‚100%æ»¡è¶³**
- æˆåŠŸå®ç°ä»…ITPæ–‡ä»¶çš„è½¬æ¢æ¨¡å¼
- å®Œç¾æ”¯æŒGAFF2ç­‰æ ‡å‡†åŠ›åœº
- ç”Ÿæˆçš„æ ¼å¼ä¸ç”¨æˆ·ç¤ºä¾‹å®Œå…¨ä¸€è‡´

**âœ… æŠ€æœ¯å®ç°ä¼˜é›…é«˜æ•ˆ**
- æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- æ™ºèƒ½å‘½åç®—æ³•ï¼Œç”Ÿæˆæœ‰æ„ä¹‰çš„åŸå­æ ‡è¯†
- ç®€åŒ–çš„ç”Ÿæˆé€»è¾‘ï¼Œç¬¦åˆåŠ›åœºæœ€ä½³å®è·µ

**âœ… å·¥å…·å®Œæ•´æ€§æå‡**
- æ”¯æŒä»ç®€å•ITPåˆ°å¤æ‚ç³»ç»Ÿçš„å…¨æµç¨‹
- ç»Ÿä¸€çš„å‘½ä»¤è¡Œæ¥å£ï¼Œä½¿ç”¨ä¾¿æ·
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

### ä¸‹ä¸€æ­¥

ç°åœ¨å·¥å…·å·²ç»å®Œå…¨æ”¯æŒï¼š
1. **è‡ªå®šä¹‰åŠ›åœºæ¨¡å¼** (custom-ff): ç”Ÿæˆå®Œæ•´åŠ›åœºå®šä¹‰
2. **æ ‡å‡†åŠ›åœºæ¨¡å¼** (æŒ‡å®š-få‚æ•°): ç»§æ‰¿å·²çŸ¥åŠ›åœºï¼Œä»…ç”ŸæˆBond List
3. **å®Œæ•´ç³»ç»Ÿæ¨¡å¼** (TOP+åæ ‡): å¤„ç†å¤æ‚å¤šåˆ†å­ç³»ç»Ÿ

è½¬æ¢å·¥å…·ç°å·²æˆä¸ºåŠŸèƒ½å®Œæ•´ã€çµæ´»å¼ºå¤§çš„GROMACS-LAMMPSæ¡¥æ¢å·¥å…·ï¼

---

*æµ‹è¯•å®Œæˆæ—¶é—´: 2025-07-23*  
*ç‰ˆæœ¬: 1.5.0*  
*æµ‹è¯•çŠ¶æ€: âœ… å…¨éƒ¨é€šè¿‡* 